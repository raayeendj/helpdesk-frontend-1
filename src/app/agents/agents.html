<div class="agents-container">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <lucide-icon name="shield" class="icon"></lucide-icon>
      <span>Admin Panel</span>
    </div>

    <nav class="menu">
      <a href="#" class="menu-item" [class.active]="viewMode === 'agents'" (click)="switchView('agents')">
        <lucide-icon name="users"></lucide-icon>
        Agents
      </a>
      <a href="#" class="menu-item" [class.active]="viewMode === 'teams'" (click)="switchView('teams')">
        <lucide-icon name="building"></lucide-icon>
        Teams
      </a>
      <a routerLink="/reports" class="menu-item">
        <lucide-icon name="bar-chart-2"></lucide-icon>
        Reports
      </a>
    </nav>
  </aside>


  <!-- Main Content (divisé en deux frames verticales) -->
  <main class="main">
    <div class="content-frame">
      <!-- ======= FRAME GAUCHE : Liste des agents ou équipes ======= -->
      <div class="list-frame">
        <div class="header">
          <h2>{{ viewMode === 'agents' ? 'Agents' : 'Teams' }}</h2>
          <button class="add-btn" (click)="viewMode === 'agents' ? addAgent() : addTeam()">
            <lucide-icon name="plus"></lucide-icon>
            Add {{ viewMode === 'agents' ? 'Agent' : 'Team' }}
          </button>
        </div>

        <div class="agents-list">
          <div class="card" *ngFor="let item of (viewMode === 'agents' ? agents : teams)" (click)="viewDetails(item)">
            <div class="card-header">
              <lucide-icon name="{{ viewMode === 'agents' ? 'user' : 'building' }}"></lucide-icon>
              <h3>{{ item.name }}</h3>
            </div>
            <p *ngIf="viewMode === 'agents'">{{ item.role }}</p>
            <p *ngIf="viewMode === 'teams'">Members: {{ item.members }}</p>
            <span class="status" *ngIf="viewMode === 'agents'" [class.active]="item.status === 'Actif'">
              {{ item.status }}
            </span>
            <span class="status" *ngIf="viewMode === 'teams'" [class.active]="true">
              {{ item.description }}
            </span>
          </div>
        </div>
      </div>

      <!-- ======= FRAME DROITE : Détails ======= -->
      <div class="details-panel">
        <div class="details-header">
          <h3>Details</h3>
          <!-- Remplacement du bouton Add par un bouton Invite -->
          <button class="edit-btn" (click)="invite()" *ngIf="!selectedItem">
            <lucide-icon name="send"></lucide-icon>
            Invite
          </button>

          <!-- Bouton Edit si un élément est sélectionné -->
          <button class="edit-btn" (click)="editItem()" *ngIf="selectedItem">
            <lucide-icon name="pen-tool"></lucide-icon>
          </button>
        </div>

        <div *ngIf="!selectedItem" class="placeholder">
          <p>Invite a new {{ viewMode }} to get started.</p>
        </div>

        <div *ngIf="selectedItem" class="detail-content">
          <div class="avatar">
            <lucide-icon name="{{ viewMode === 'agents' ? 'user' : 'building' }}" size="40"></lucide-icon>
          </div>
          <h4>{{ selectedItem.name }}</h4>
          <p *ngIf="viewMode === 'agents'"><strong>Role:</strong> {{ selectedItem.role }}</p>
          <p *ngIf="viewMode === 'agents'"><strong>Status:</strong> <span class="status" [class.active]="selectedItem.status === 'Actif'">{{ selectedItem.status }}</span></p>
          <!-- Add to team button (visible when viewing an agent) -->
          <div *ngIf="viewMode === 'agents'" class="add-to-team">
            <button class="small-btn" (click)="toggleAddToTeam()">Add to team</button>

            <div *ngIf="showAddToTeam" class="add-to-team-panel">
              <label for="teamSelect">Choose team:</label>
              <select id="teamSelect" [(ngModel)]="selectedTeamId">
                <option [ngValue]="null">-- select --</option>
                <option *ngFor="let t of teams" [ngValue]="t.id">{{ t.name }}</option>
              </select>
              <button class="small-btn" (click)="confirmAddToTeam()" [disabled]="!selectedTeamId">Add</button>
              <button class="small-btn ghost" (click)="cancelAddToTeam()">Cancel</button>
            </div>
          </div>
          <p *ngIf="viewMode === 'teams'"><strong>Members:</strong> {{ selectedItem.members }}</p>
          <p *ngIf="viewMode === 'teams'"><strong>Description:</strong> {{ selectedItem.description }}</p>
        </div>
      </div>
    </div>
  </main>
</div>
